# Changelog

All notable changes to the Portfolio Analysis Agent Group will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [2.0.0] - 2025-12-16

### Changed (BREAKING CHANGES)

- **Architecture redesign**: Replaced 5 code-generation agents with 1 unified `portfolio-code-writer` agent + `portfolio_toolkit` Python library
- **Agent consolidation**: Removed `portfolio-data-engineer`, `portfolio-analyst`, `portfolio-risk-assessor`, `portfolio-visualizer`, and `portfolio-report-generator` agents (now implemented as library modules)
- **Workflow simplified**: Users now interact with single `portfolio-code-writer` agent instead of chaining through 5 different agents
- **Handoff chain updated**: Reduced from 5-7 agent handoffs to 1-3 handoffs (code-writer → code-reviewer → devils-advocate)

### Added

- **portfolio_toolkit library**: Comprehensive Python library with 5 modules:
  - `data.py`: Data loading, cleaning, validation (replaces portfolio-data-engineer agent)
  - `metrics.py`: Financial calculations (Sharpe, returns, drawdown) (replaces portfolio-analyst agent)
  - `risk.py`: Risk assessment (VaR, CVaR, Monte Carlo, stress testing) (replaces portfolio-risk-assessor agent)
  - `viz.py`: Visualization functions (matplotlib/seaborn charts) (replaces portfolio-visualizer agent)
  - `reports.py`: Report generation (HTML, markdown, Excel) (replaces portfolio-report-generator agent)
- **portfolio-code-writer agent**: New unified agent that generates complete analysis scripts using portfolio_toolkit
- **setup.py**: Makes portfolio_toolkit installable via pip (`pip install -e .`)
- **archive/v1/**: Archived v1.0.0 agents for reference and backward compatibility research

### Migration Guide (v1.0.0 → v2.0.0)

**Before (v1.0.0 workflow)**:
1. User: "Analyze my portfolio"
2. Hand off to @portfolio-data-engineer → generates data loading code
3. Hand off to @portfolio-analyst → generates metrics code
4. Hand off to @portfolio-risk-assessor → generates risk code
5. Hand off to @portfolio-visualizer → generates chart code
6. Hand off to @portfolio-report-generator → generates report code
7. Hand off to @code-quality-reviewer → reviews all generated code
8. Hand off to @devils-advocate → critical review
9. Deliver code to user

**After (v2.0.0 workflow)**:

**Option A (Beginner - Agent-Assisted)**:
1. User: "Analyze my portfolio"
2. Hand off to @portfolio-code-writer → generates complete script using portfolio_toolkit
3. Hand off to @code-quality-reviewer → reviews script
4. Hand off to @devils-advocate → critical review
5. Deliver script to user

**Option B (Advanced - Direct Library Usage)**:
1. User installs portfolio_toolkit: `pip install -e .`
2. User writes their own Python code importing library modules
3. User optionally consults @code-quality-reviewer or @devils-advocate

**Benefits of v2.0.0**:
- **Faster**: 1 handoff instead of 5 for code generation
- **Consistent**: All code uses same tested library functions
- **Maintainable**: Update financial formulas in library, not agent instructions
- **Testable**: Library functions include unit tests and type hints
- **Flexible**: Supports both agent-assisted and direct library usage

**Breaking Changes**:
- Old agent names (@portfolio-data-engineer, @portfolio-analyst, etc.) no longer exist
- Scripts generated by v1.0.0 agents will NOT work with v2.0.0 (different code structure)
- Users must regenerate analysis scripts with @portfolio-code-writer or refactor to use portfolio_toolkit library

**Backward Compatibility**:
- v1.0.0 agent definitions archived in `archive/v1/` directory
- Financial formulas and calculations remain identical (no formula changes)
- If you have v1.0.0 generated code that works, you can continue using it (no forced migration)

**How to Migrate Existing Scripts**:
1. Install portfolio_toolkit: `pip install -e portfolio-analysis/`
2. Refactor code to import from portfolio_toolkit modules:
   ```python
   # Old (v1.0.0 - inline functions)
   def calculate_sharpe_ratio(returns, rf_rate):
       # ... implementation
   
   # New (v2.0.0 - import from library)
   from portfolio_toolkit.metrics import calculate_sharpe_ratio
   ```
3. Or regenerate script with @portfolio-code-writer agent

**Context for Breaking Change**:

The v1.0.0 architecture used agents to generate boilerplate code for deterministic tasks (data loading, formula calculations, chart creation). This created unnecessary overhead:
- Users waited for 5 sequential agent handoffs for straightforward code generation
- Same formulas were "generated" repeatedly instead of being reused from a library
- Updating formulas required changing agent instructions rather than updating code
- Testing was difficult (agents generated code, but code wasn't unit tested)

The v2.0.0 architecture recognizes that **deterministic code generation is better solved with libraries, not agents**. Agents should focus on decision-making and analytical tasks, not formula implementation.

**What was lost**: None. All functionality from v1.0.0 is preserved in v2.0.0 library.

**What was gained**:
- Speed (1 handoff vs 5)
- Quality (tested library functions)
- Maintainability (update formulas in one place)
- Flexibility (direct library access for advanced users)

---

## [1.0.0] - 2024-12-15

### Added

- Initial release of Portfolio Analysis Agent Group
- 7 agents:
  - `portfolio-data-engineer`: Data loading and cleaning code generation
  - `portfolio-analyst`: Financial metrics calculation code generation
  - `portfolio-risk-assessor`: Risk assessment code generation
  - `portfolio-visualizer`: Chart generation code
  - `portfolio-report-generator`: Report assembly code
  - `code-quality-reviewer`: Code review and best practices
  - `devils-advocate`: Critical review and assumption challenging
- Comprehensive workflow for portfolio analysis
- Decision trees for user navigation
- Quality gates at each stage
- Support for CSV, Excel, and API data sources
- Benchmark comparison capabilities
- Stress testing and Monte Carlo simulation
- HTML and PDF report generation
